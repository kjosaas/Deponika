<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hyllesystem</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1>Deponika 游뱂</h1>
      <input type="text" id="search" placeholder="Skriv noe her.." />
      <p>
        Deponika er ein nettapplikasjon som gjer det mogleg for deg 친 s칮ke etter
        plassering av arkiv hj친 IKA Hordaland. Du kan s칮ke ved 친 skrive i
        s칮keboksen. Tabellen vert oppdatert samstundes som du skriv.
      </p>
      <p>
        N친r du klikkar p친 ei ASTA-ID i f칮rste kolonnen, opnar nettsida eit nytt
        nettleservindauge som gjer eit s칮k p친 arkivportalen.no etter IDen i
        denne cella.
      </p>

      <table id="myTable">
        <thead>
          <tr>
            <th>ASTA-id</th>
            <th>Arkivskaper</th>
            <th>Serie</th>
            <th>Plassering fr친</th>
            <th>Plassering til</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </header>

    <script>
      const searchInput = document.querySelector("#search");
      const tableBody = document.querySelector("#myTable tbody");

      searchInput.addEventListener("input", (event) => {
        const searchQuery = event.target.value.toLowerCase();

        fetch("data.csv")
          .then((response) => response.text())
          .then((data) => {
            const rows = data.split("\n");

            tableBody.innerHTML = ""; // Clear the table

            rows.forEach((row) => {
              const cells = row.split(",");
              // Check if any of the cells contain the search query (case-insensitive)
              if (
                cells.some((cell) => cell.toLowerCase().includes(searchQuery))
              ) {
                const rowEl = document.createElement("tr");

                cells.forEach((cell) => {
                  const cellEl = document.createElement("td");
                  cellEl.textContent = cell;
                  rowEl.appendChild(cellEl);
                });
                tableBody.appendChild(rowEl);
              }
            });
          });
      });
      window.onload = function () {
        const dataRows = document.querySelectorAll("#myTable tr");
        dataRows.forEach((row) => {
          const firstCell = row.querySelector("td:first-child");
          tableBody.addEventListener("click", (event) => {
            if (event.target.tagName === "TD") {
              if (event.target.cellIndex === 0) {
                // assuming ASTA-id is in the first column
                const cellData = event.target.innerHTML;
                window.open(
                  `https://www.arkivportalen.no/search/1?unitType=1000&repository=IKAH&text=${cellData}`
                );
              }
            }
          });
        });
      };
    </script>
  </body>
</html>
