<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hyllesystem</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <button id="english-button">English</button>
      <button id="print-button" disabled>Print</button>
      <button id="email-button">Meld feil eller endring</button>
      <h1>Deponika 游뱂</h1>
      <input type="text" id="search" placeholder="Skriv noko.." />
      <p>
        Deponika gjer det mogleg for deg 친 s칮ke etter plassering av arkiv. S칮k
        ved 친 skrive i s칮keboksen over. Tabellen vert oppdatert n친r du skriv.
      </p>
      <p>Klikk p친 ASTA-ID for 친 opne p친 arkivportalen.no.</p>
      <p>
        Klikk p친 Arkivskaper for 친 opne p친 digitalarkivet.no (ps. pr칮v
        Hillestveit skule)
      </p>
      <div id="table-wrapper">
        <table id="myTable">
          <thead>
            <tr>
              <th>ASTA-ID</th>
              <th>Arkivskaper</th>
              <th>Serie</th>
              <th>Plassering fr친</th>
              <th>Plassering til</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </header>
    <script>
      const printButton = document.querySelector("#print-button");
      const searchInput = document.querySelector("#search");
      const tableBody = document.querySelector("#myTable tbody");

      searchInput.addEventListener("input", async (event) => {
        const searchQuery = event.target.value.toLowerCase();
        const searchWords = searchQuery.split(" ");
        printButton.removeAttribute("disabled");
        const data = await (await fetch("data.csv")).text();
        const rows = data.split("\n");
        tableBody.innerHTML = "";
        rows.forEach((row) => {
          const cells = row.split(",");
          if (
            searchWords.every((word) =>
              cells.some((cell) => cell.toLowerCase().includes(word))
            )
          ) {
            const rowEl = document.createElement("tr");
            cells.forEach((cell) => {
              const cellEl = document.createElement("td");
              cellEl.textContent = cell;
              rowEl.appendChild(cellEl);
            });
            tableBody.appendChild(rowEl);
          }
        });
      });

      window.onload = function () {
        const dataRows = document.querySelectorAll("#myTable tr");
        dataRows.forEach((row) => {
          const firstCell = row.querySelector("td:first-child");
          tableBody.addEventListener("click", (event) => {
            if (event.target.tagName === "TD" && event.target.cellIndex === 0) {
              const cellData = event.target.innerHTML;
              window.open(
                `https://www.arkivportalen.no/search/1?unitType=1000&repository=IKAH&text=${cellData}`
              );
            }
          });
        });
      };
      tableBody.addEventListener("click", (event) => {
        if (event.target.tagName === "TD" && event.target.cellIndex === 1) {
          const cellData = event.target.innerHTML;
          window.open(
            `https://media.digitalarkivet.no/db/browse?depository%5B%5D=89&start_year=&end_year=&text=${cellData}`
          );
        }
      });

      const emailButton = document.querySelector("#email-button");
      emailButton.addEventListener("click", () => {
        const subject = "Feedback for Deponika";
        const body =
          "Hei, jeg har funnet en feil eller har en opplysning jeg vil legge til i Deponika. Det gjelder ...";
        const email =
          "mailto:knut.kjosaas@ikah.no?subject=" + subject + "&body=" + body;
        window.location.href = email;
      });

      const englishButton = document.querySelector("#english-button");
      englishButton.addEventListener("click", () => {
        alert("Nei!! \n\nSida f친r du sj칮lvsagt berre p친 nynorsk !! \n\n  ");
      });

      printButton.addEventListener("click", () => {
        const table = document.querySelector("#myTable");
        newWin = window.open("");
        newWin.document.write(table.outerHTML);
        newWin.print();
        newWin.close();
      });
    </script>
  </body>
</html>
